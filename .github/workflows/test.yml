name: bigfastapi test
on:
  push:
    branches: [ dev ]

  pull_request:
    branches: [ staging, dev ]

jobs:
  test:
    runs-on: self-hosted
    strategy:
      matrix:
        python-version: [3.9]

    steps:
        # Checkout the latest code from the repo
      - name: Checkout repo
        uses: actions/checkout@v2
        # Setup which version of Python to use
      - name: Set Up Python ${{ matrix.python-version }}
        uses: actions/setup-python@v2
        with:
          python-version: ${{ matrix.python-version }}
        # Display the Python version being used
      - name: Display Python version
        run: python -c "import sys; print(sys.version)"
        # Install the package using the setup.py
      - name: Install Dependencies and requirements
        env:
           DB_TYPE: ${{ secrets.DB_TYPE }}
           DB_NAME: ${{ secrets.DB_NAME }}
           DB_USER: ${{ secrets.DB_USER }}
           DB_PASSWORD: ${{ secrets.DB_TYPE }}
           DB_HOST: ${{ secrets.DB_HOST }}
           DB_PORT: ${{ secrets.DB_PORT }}
           JWT_SECRET: jwt
           TEMPLATE_FOLDER: "bigfastapi/templates"
           EMAIL_VERIFICATION_TEMPLATE: "email/welcome_email.html"
           PASSWORD_RESET_TEMPLATE: "email/password_reset.html"
           FILES_BASE_FOLDER: "filestorage"
           GOOGLE_CLIENT_ID: "google"
           GOOGLE_CLIENT_SECRET: google
           REDIRECT_URL: lis
           MAIL_USERNAME: nil 
           MAIL_PASSWORD: nil
           MAIL_FROM: nil
           MAIL_PORT: 465
           MAIL_SERVER: nil
           MAIL_FROM_NAME: nil
           GOOGLE_SECRET: nil
           API_URL: nil
           FRONTEND_URL: nil 
           SENTRY_DSN: nil
           FREECURRENCY_API_KEY: nil
           FLUTTERWAVE_SEC_KEYYYYUUUUU: nil
           FLUTTERWAVE_SEC_KEY: nil
           APP_URL: nil
           STRIPE_SEC_KEY: nil

        run: |
          python -m pip install --upgrade pip
          pytest tests/test*
          pip install -r requirements.txt
        # Run the tests. I'm using pytest and the file is in the tests directory.
